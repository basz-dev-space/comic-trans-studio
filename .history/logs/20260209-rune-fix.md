# Bug Fix: $state Rune Outside Svelte

## Date

2026-02-09

## Issue

```
500 error: Svelte error: rune_outside_svelte
The `$state` rune is only available inside `.svelte` and `.svelte.js/ts` files
```

## Root Cause

The `editorStore.ts` was using `$state` rune in a regular `.ts` file, which is not supported by Svelte 5.

## Solution

1. **Renamed** `editorStore.ts` â†’ `editorStore.svelte.ts`
2. **Created** a factory function `createEditorStore()` that returns an object with reactive `$state` variables
3. **Exported** `editorStore = createEditorStore()` from the `.svelte.ts` file
4. **Updated all imports** across the codebase:
   - `src/lib/components/canvas/CanvasEditor.svelte`
   - `src/lib/components/canvas/PropertiesPanel.svelte`
   - `src/lib/components/canvas/LayerPanel.svelte`
   - `src/lib/components/canvas/ExportDialog.svelte`
   - `src/lib/components/canvas/PageDialog.svelte`
   - `src/lib/components/canvas/CanvasViewport.svelte`
   - `src/lib/components/canvas/PagePanel.svelte`
   - `src/lib/canvas/CanvasManager.ts`
   - `src/routes/project/chapter/[id]/+page.svelte`
5. **Removed** the old `editorStore.ts` file

## Validation

- Dev server starts successfully
- No more `$state` rune errors
- All imports resolved correctly

## Files Modified

- `src/lib/stores/editorStore.svelte.ts` (renamed from `.ts`)
- `src/lib/stores/editorStore.ts` (deleted)
- 9 import statements updated across the codebase
